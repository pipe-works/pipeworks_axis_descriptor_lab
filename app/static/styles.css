/*
 * app/static/styles.css
 * ─────────────────────────────────────────────────────────────────────────────
 * Pipe-Works Axis Descriptor Lab – app-specific styles.
 *
 * Foundation layers (loaded before this file):
 *   1. pipe-works-fonts.css   – @font-face declarations (editorial + monospace)
 *   2. pipe-works-base.css    – design tokens, reset, common components
 *
 * This file contains only layout and components specific to the Axis
 * Descriptor Lab that are not shared across Pipe-Works tools.
 */

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER — position override
   ─────────────────────────────────────────────────────────────────────────
   Base CSS uses flex-shrink: 0 (flex parent layout).  The lab uses a
   fixed three-column grid, so the header and status bar must be
   position: fixed to stay outside the grid.
════════════════════════════════════════════════════════════════════════════ */

.app-header {
  position: fixed;
  top: 0; left: 0; right: 0;
}

/* ═══════════════════════════════════════════════════════════════════════════
   MAIN GRID
════════════════════════════════════════════════════════════════════════════ */

.app-grid {
  display: grid;
  grid-template-columns: 320px 1fr 380px;
  gap: 1px;                          /* gap becomes the border between panels */
  background: var(--col-border);     /* the border colour shows through the gap */

  position: fixed;
  top: var(--header-h);
  bottom: var(--statusbar-h);
  left: 0; right: 0;
  overflow: hidden;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PANEL VARIANTS
════════════════════════════════════════════════════════════════════════════ */

/* ─── Left panel: darker background ───────────────────────────────────── */
.panel--left {
  background: var(--col-bg);
}

/* Let the JSON textarea fill all remaining vertical space in the left panel */
.panel--left .code-editor {
  flex: 1 1 0;
  min-height: 8rem;
}

/* ─── Centre panel: default surface ───────────────────────────────────── */
.panel--centre {
  background: var(--col-surface);
}

/* ─── Right panel: elevated surface ───────────────────────────────────── */
.panel--right {
  background: var(--col-surface-2);
}

/* ═══════════════════════════════════════════════════════════════════════════
   SLIDER PANEL
════════════════════════════════════════════════════════════════════════════ */

.slider-panel {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
  flex: 1;
  overflow-y: auto;
}

/* Each axis row */
.axis-row {
  display: grid;
  grid-template-columns: 110px 1fr minmax(70px, max-content);
  align-items: center;
  gap: var(--sp-2);
  padding: var(--sp-1) 0;
  border-bottom: 1px solid var(--col-border);
}

.axis-row:last-child {
  border-bottom: none;
}

/* Axis name */
.axis-name {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  text-transform: lowercase;
  letter-spacing: 0.04em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Axis sub-row: slider + score display */
.axis-slider-row {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
}

/* Modified indicator — amber accent when a score or label differs from the
   originally loaded example.  Applied dynamically by buildSlidersFromJson()
   and the slider/label input event listeners. */
.axis-modified {
  color: var(--col-accent) !important;
}

.axis-score {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  min-width: 38px;
  text-align: right;
}

/* Label input (editable) — default colour is normal text so the amber
   .axis-modified highlight is visible when the user changes a label. */
.axis-label-input {
  background: transparent;
  border: none;
  border-bottom: 1px dashed var(--col-border);
  color: var(--col-text);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  padding: 1px 2px;
  width: 100%;
  transition: border-color var(--transition-fast), color var(--transition-fast);
}

.axis-label-input:focus {
  border-bottom-color: var(--col-accent);
  outline: none;
}

/* Range row (temperature) */
.range-row {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
}

.code-editor--sm {
  font-size: var(--text-xs);
}

/* ═══════════════════════════════════════════════════════════════════════════
   SETTINGS GRID (model / temperature / tokens)
════════════════════════════════════════════════════════════════════════════ */

.settings-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  gap: var(--sp-2) var(--sp-3);
  margin-top: var(--sp-2);
}

.settings-grid .control-label {
  margin-bottom: 0;
}

.model-row {
  display: flex;
  gap: var(--sp-2);
}

.model-row .select,
.model-row .input {
  flex: 1;
}

/* Ollama URL input: wider than the model select to accommodate full URLs. */
.model-row .input--url {
  flex: 1.8;
  min-width: 0;
  font-size: var(--text-sm);
}

/* ═══════════════════════════════════════════════════════════════════════════
   OUTPUT PANEL
════════════════════════════════════════════════════════════════════════════ */

.output-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.output-actions {
  display: flex;
  gap: var(--sp-1);
}

.output-meta {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  border-top: 1px solid var(--col-border);
  padding-top: var(--sp-2);
}

/* Faint key-value table for generation metadata */
.meta-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--col-text-muted);
}

/* Faint row separator — just enough to guide the eye */
.meta-table tr + tr td {
  border-top: 1px solid color-mix(in srgb, var(--col-border) 50%, transparent);
}

/* Label column: right-aligned, muted, fixed width */
.meta-table .meta-key {
  text-align: right;
  padding: 2px var(--sp-2) 2px 0;
  white-space: nowrap;
  opacity: 0.55;
  width: 1%;
}

/* Value column: left-aligned, slightly brighter */
.meta-table .meta-val {
  text-align: left;
  padding: 2px 0;
  opacity: 0.8;
  white-space: pre-wrap;
}

/* Tiny inline copy button for the seed row when the seed was random. */
.meta-copy-btn {
  all: unset;
  cursor: pointer;
  font-size: 0.65rem;
  padding: 1px 5px;
  margin-left: var(--sp-1);
  border: 1px solid color-mix(in srgb, var(--col-border) 60%, transparent);
  border-radius: 3px;
  opacity: 0.5;
  vertical-align: middle;
  transition: opacity 0.15s, border-color 0.15s;
}

.meta-copy-btn:hover {
  opacity: 1;
  border-color: var(--col-accent);
  color: var(--col-accent);
}

/* Highlight meta rows that differ from the baseline (A) snapshot.
   Uses the amber accent so it feels integrated with the rest of the UI
   rather than alarming (this is informational, not an error). */
.meta-table tr.meta-changed .meta-key,
.meta-table tr.meta-changed .meta-val {
  color: var(--col-accent);
  opacity: 1;
}

/* ═══════════════════════════════════════════════════════════════════════════
   DIFF VIEW
════════════════════════════════════════════════════════════════════════════ */

/*
 * Vertical stack layout for the A/B comparison boxes in the centre panel.
 * Replaces the old side-by-side .diff-grid now that A and B live below
 * the sliders rather than squeezed into the right panel.
 */
.diff-stack {
  display: flex;
  flex-direction: column;
  gap: var(--sp-3);
}

.diff-label {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: var(--sp-1);
}

/* Diff boxes — same overflow treatment as the output box to handle
   long model outputs that exceed the token budget. */
.diff-box {
  background: var(--col-code-bg);
  border: 1px solid var(--col-border);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  line-height: 1.6;
  max-height: 40vh;
  overflow-y: auto;
  min-height: 80px;
  padding: var(--sp-2) var(--sp-3);
  white-space: pre-wrap;
  word-break: break-word;
}

.diff-box--a { border-color: var(--col-border-hi); }
.diff-box--b { border-color: var(--col-border-hi); }

/* Word-level diff */
.diff-delta {
  background: var(--col-code-bg);
  border: 1px solid var(--col-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.8;
  min-height: 60px;
  max-height: 40vh;
  overflow-y: auto;
  padding: var(--sp-2) var(--sp-3);
  white-space: pre-wrap;
  word-break: break-word;
}

.diff-add  { background: var(--col-diff-add);  color: var(--col-diff-add-text); border-radius: 2px; padding: 0 2px; }
.diff-del  { background: var(--col-diff-del);  color: var(--col-diff-del-text); border-radius: 2px; padding: 0 2px; text-decoration: line-through; }

/* ═══════════════════════════════════════════════════════════════════════════
   SIGNAL ISOLATION PANEL — Two-Column "Semantic Pivot" Layout
   ─────────────────────────────────────────────────────────────────────────
   Side-by-side REMOVED / ADDED columns so the eye can scan left-to-right
   and immediately grasp the lexical pivot.  Uses subtle text colour and
   strikethrough instead of tag backgrounds to minimise visual noise,
   following the spec's "no colour noise" principle.
════════════════════════════════════════════════════════════════════════════ */

/* Container for the signal isolation results */
.signal-panel {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.8;
  max-height: 20rem;
  overflow-y: auto;
}

/* Two-column grid: REMOVED on the left, ADDED on the right */
.signal-columns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  border: 1px solid var(--col-border);
  border-radius: 2px;
}

/* Column headers: "REMOVED (19)" / "ADDED (24)" */
.signal-header {
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: var(--sp-1);
  border-bottom: 1px solid var(--col-border);
}

/* Vertical divider between the two columns */
.signal-columns > :nth-child(odd) {
  border-right: 1px solid var(--col-border);
}

/* Vertical word list within each column */
.signal-word-list {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

/* Individual word entry — plain text, faint row separator */
.signal-word {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.7;
  padding: 1px var(--sp-1);
  border-bottom: 1px solid var(--col-border);
}

.signal-word:last-child {
  border-bottom: none;
}

/* Removed words — subtle red text, no strikethrough for legibility */
.signal-word--removed {
  color: var(--col-diff-del-text);
}

/* Added words — subtle green text, no decoration */
.signal-word--added {
  color: var(--col-diff-add-text);
}

/* ═══════════════════════════════════════════════════════════════════════════
   TRANSFORMATION MAP (clause-level alignment)
   ─────────────────────────────────────────────────────────────────────────
   Two-column table showing clause-level replacement pairs (Removed | Added).
   Follows the signal panel conventions: monospace, small text, scrollable.
════════════════════════════════════════════════════════════════════════════ */

/* Container */
.tmap-panel {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.8;
  max-height: 20rem;
  overflow-y: auto;
}

/* Full-width two-column table */
.tmap-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

/* Column headers: uppercase muted labels */
.tmap-header {
  font-size: var(--text-xs);
  color: var(--col-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  text-align: left;
  padding: 0 var(--sp-1) var(--sp-1);
  border-bottom: 1px solid var(--col-border);
}

/* Individual cells */
.tmap-cell {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.7;
  padding: var(--sp-1);
  vertical-align: top;
  border-bottom: 1px solid var(--col-border);
}

/* Removed text — subtle red */
.tmap-cell--removed {
  color: var(--col-diff-del-text);
}

/* Added text — subtle green */
.tmap-cell--added {
  color: var(--col-diff-add-text);
}

/* Empty cell placeholder (em dash for pure insert/delete rows) */
.tmap-cell--empty {
  color: var(--col-text-dim);
}

/* Controls row above the table */
.tmap-controls {
  display: flex;
  gap: var(--sp-2);
}

/* Three-column variant (REMOVED | ADDED | INDICATORS) */
.tmap-table--3col { table-layout: fixed; }
.tmap-table--3col th:nth-child(1),
.tmap-table--3col td:nth-child(1) { width: 37%; }
.tmap-table--3col th:nth-child(2),
.tmap-table--3col td:nth-child(2) { width: 37%; }
.tmap-table--3col th:nth-child(3),
.tmap-table--3col td:nth-child(3) { width: 26%; }

/* Indicator cell */
.tmap-cell--indicators {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  line-height: 1.7;
}

/* Individual micro-indicator tag (amber accent) */
.tmap-indicator {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: 0.65rem;
  line-height: 1;
  padding: 0.15em 0.4em;
  margin: 0.1em 0.15em;
  border-radius: 3px;
  background: var(--col-accent-glow);
  color: var(--col-accent);
  border: 1px solid color-mix(in srgb, var(--col-accent) 22%, transparent);
  white-space: nowrap;
}

/* ═══════════════════════════════════════════════════════════════════════════
   COLLAPSIBLE (details/summary)
════════════════════════════════════════════════════════════════════════════ */

.collapsible {
  border: 1px solid var(--col-border);
  border-radius: var(--radius-sm);
  padding: var(--sp-2) var(--sp-3);
}

.collapsible__summary {
  cursor: pointer;
  font-size: var(--text-sm);
  color: var(--col-text-muted);
  list-style: none;
  user-select: none;
}

.collapsible__summary:hover {
  color: var(--col-text);
}

.collapsible__summary::-webkit-details-marker { display: none; }

/* ═══════════════════════════════════════════════════════════════════════════
   STATUS BAR — position override
════════════════════════════════════════════════════════════════════════════ */

.status-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
}

/* ═══════════════════════════════════════════════════════════════════════════
   THEME TOGGLE
════════════════════════════════════════════════════════════════════════════ */

/*
 * The theme-toggle no longer needs margin-left: auto because the
 * tooltip-toggle (which precedes it) now carries that auto-margin
 * to push both buttons to the right end of the header.
 */
.theme-toggle {
  background: transparent;
  border: 1px solid var(--col-border-hi);
  border-radius: var(--radius-sm);
  color: var(--col-text-muted);
  cursor: pointer;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  padding: 2px var(--sp-2);
  transition: color var(--transition-fast), border-color var(--transition-fast);
}

.theme-toggle:hover {
  color: var(--col-accent);
  border-color: var(--col-accent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   TOOLTIP TOGGLE (header button)
   ─────────────────────────────────────────────────────────────────────────
   Uses the same is-active visual pattern as .btn--secondary.is-active
   (amber border + glow) to clearly show when tooltips are enabled.
════════════════════════════════════════════════════════════════════════════ */

.tooltip-toggle {
  margin-left: auto;               /* push this + theme toggle to right end of header */
  background: transparent;
  border: 1px solid var(--col-border-hi);
  border-radius: var(--radius-sm);
  color: var(--col-text-muted);
  cursor: pointer;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  padding: 2px var(--sp-2);
  transition: color var(--transition-fast),
              border-color var(--transition-fast),
              background var(--transition-fast);
}

.tooltip-toggle:hover {
  color: var(--col-accent);
  border-color: var(--col-accent);
}

/*
 * Active state mirrors .btn--secondary.is-active exactly:
 * amber border, amber text, and a subtle amber glow background.
 * This is the same visual language used by the "Set as A" button.
 */
.tooltip-toggle.is-active {
  border-color: var(--col-accent);
  color: var(--col-accent);
  background: var(--col-accent-glow);
}

/* ═══════════════════════════════════════════════════════════════════════════
   INDICATOR MODAL
   ─────────────────────────────────────────────────────────────────────────
   Click-to-open modal for micro-indicator definitions.  Created
   dynamically by mod-indicator-modal.js and appended to <body>.
   Two-layer progressive disclosure: hover tooltip + click modal.
════════════════════════════════════════════════════════════════════════════ */

/* Make indicator tags look clickable when data-indicator is present */
.tmap-indicator[data-indicator] {
  cursor: pointer;
}

.tmap-indicator[data-indicator]:hover {
  background: color-mix(in srgb, var(--col-accent) 18%, transparent);
  border-color: color-mix(in srgb, var(--col-accent) 40%, transparent);
}

/* ── Overlay backdrop ──────────────────────────────────────────────────── */

.indicator-modal-overlay {
  display: none;                     /* hidden by default                 */
  position: fixed;
  inset: 0;
  z-index: 11000;                    /* above tooltips (10001)            */
  background: var(--col-backdrop);
  align-items: center;
  justify-content: center;
}

.indicator-modal-overlay.is-visible {
  display: flex;
}

/* ── Modal panel ───────────────────────────────────────────────────────── */

.indicator-modal {
  position: relative;
  background: var(--col-surface);
  border: 1px solid var(--col-border-hi);
  border-radius: 6px;
  padding: var(--sp-6);
  max-width: 480px;
  width: 90vw;
  max-height: 80vh;
  overflow-y: auto;
  font-family: var(--font-mono);
  color: var(--col-text);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.50);
}

/* ── Close button (top-right x) ───────────────────────────────────────── */

.indicator-modal__close {
  position: absolute;
  top: var(--sp-2);
  right: var(--sp-2);
  background: none;
  border: none;
  color: var(--col-text-muted);
  font-size: 1.2rem;
  cursor: pointer;
  line-height: 1;
  padding: var(--sp-1);
}

.indicator-modal__close:hover {
  color: var(--col-text);
}

/* ── Title ─────────────────────────────────────────────────────────────── */

.indicator-modal__title {
  font-size: 1rem;
  color: var(--col-accent);
  margin-bottom: var(--sp-3);
  padding-right: var(--sp-4);        /* space for close button            */
}

/* ── Definition list (dt/dd pairs in a CSS grid) ───────────────────────── */

.indicator-modal__dl {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--sp-1) var(--sp-3);
  font-size: var(--text-sm);
  margin-bottom: var(--sp-3);
}

.indicator-modal__dl dt {
  color: var(--col-text-muted);
  font-weight: 600;
  text-transform: uppercase;
  font-size: var(--text-xs);
  align-self: start;
  padding-top: 0.15em;
}

.indicator-modal__dl dd {
  color: var(--col-text);
  line-height: 1.5;
}

/* ── Example removed/added pair ────────────────────────────────────────── */

.indicator-modal__example {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--sp-2);
  font-size: var(--text-xs);
}

.indicator-modal__example-removed {
  color: var(--col-err);
  opacity: 0.8;
}

.indicator-modal__example-added {
  color: var(--col-ok);
}

/* ── Docs link ─────────────────────────────────────────────────────────── */

.indicator-modal__docs-link {
  display: inline-block;
  font-size: var(--text-xs);
  color: var(--col-accent);
  text-decoration: none;
  margin-top: var(--sp-2);
}

.indicator-modal__docs-link:hover {
  text-decoration: underline;
}

/* ═══════════════════════════════════════════════════════════════════════════
   LIGHT THEME — app-specific overrides
   ─────────────────────────────────────────────────────────────────────────
   Only overrides for app-specific components that can't be handled by
   base CSS token swapping alone.  Token overrides, badge overrides,
   scrollbar, range-input thumb, and tooltip colours are all handled
   by pipe-works-base.css.
════════════════════════════════════════════════════════════════════════════ */

/* Light-mode indicator tags — use accent tokens for consistent theming */
[data-theme="light"] .tmap-indicator {
  background: color-mix(in srgb, var(--col-accent) 10%, transparent);
  color: var(--col-accent);
  border-color: color-mix(in srgb, var(--col-accent) 35%, transparent);
}

[data-theme="light"] .tmap-indicator[data-indicator]:hover {
  background: color-mix(in srgb, var(--col-accent) 20%, transparent);
  border-color: color-mix(in srgb, var(--col-accent) 55%, transparent);
}
